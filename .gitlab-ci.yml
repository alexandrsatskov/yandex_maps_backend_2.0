# Общие настройки

stages:
  - build

services:
  - postgis/postgis
variables:
  POSTGRES_DB: maps
  POSTGRES_USER: user
  POSTGRES_PASSWORD: hackme
  POSTGRES_HOST_AUTH_METHOD: trust

backend:build:python:
  stage: build
  image: snakepacker/python:all
  rules:
    - if: $CI_COMMIT_BRANCH
  before_script:
    - python3.8 -m venv env
    - env/bin/pip install -U pip
    - env/bin/pip install -U '.[dev]'
    - source env/bin/activate
  script:
    - pytest -vv
